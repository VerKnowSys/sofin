#!/usr/bin/env sh


load_sofin () {

    # NOTE: Load core.fact for basic definitions:
    if [ -d "/usr/share/sofin/facts/" -a \
         -f "/usr/share/sofin/facts/core.fact" ]; then
        . /usr/share/sofin/facts/core.fact
    elif [ -d "share/sofin/facts/" -a \
         -f "share/sofin/facts/core.fact" ]; then
        . share/sofin/facts/core.fact
    fi

    # loading functions have to know both FACTS and FUNS dirs:
    load_facts () {
        for _fact in $*; do
            . ${DEFAULT_FACTS_DIR}${_fact}
        done
        unset _fact
    }


    load_funs () {
        for _fun in $*; do
            . ${DEFAULT_FUNS_DIR}${_fun}
        done
        unset _fun
    }


    # determining facts:
    load_facts \
        paths.fact \
        system.fact \
        terminal.fact \
        sofin.fact \
        security.fact

    # loading functions:
    load_funs \
        core.fun \
        validations.fun \
        commons.fun \
        envs.fun \
        internals.fun \
        cleaners.fun \
        caches.fun \
        definitions.fun \
        datasets.fun \
        build.fun

    setup_defs_branch
    setup_defs_repo
    check_os
    check_defs_dir
    trap_signals
    store_security_state
}

load_sofin
